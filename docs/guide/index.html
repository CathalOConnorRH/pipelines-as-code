<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Pipeline as Code - Usage Guide #  Repository CRD #  The purposes of the Repository CRD is :
 To let Pipelines as Code know that this event from this URL needs to be handled. To let Pipelines as Code know on which namespace the PipelineRuns are going to be executed. To reference a api secret, username or api URL if needed for the git provider platforms that requires it (ie: when you are using webhooks method and not the github application)."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Usage Guide"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="/docs/guide/"><title>Usage Guide | Pipelines as Code</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.7572659263b1daafc3e4d5bb97e500a1612f03dfc5e11d1be8033a18685aa68a.js></script>
<link rel=alternate type=application/rss+xml href=/docs/guide/index.xml title="Pipelines as Code"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/pipelines-logo.svg alt=Logo><span>Pipelines as Code</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/install/>Installation</a><ul><li><a href=/docs/install/github_apps/>Github Apps</a></li><li><a href=/docs/install/github_webhook/>Github Webhook</a></li><li><a href=/docs/install/gitlab/>Gitlab</a></li><li><a href=/docs/install/bitbucket_cloud/>Bitbucket Cloud</a></li><li><a href=/docs/install/bitbucket_server/>Bitbucket Server</a></li></ul></li><li><a href=/docs/guide/ class=active>Usage Guide</a><ul><li><a href=/docs/guide/resolver/>Resolver</a></li><li><a href=/docs/guide/cli/>CLI tkn-pac</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Usage Guide</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#pipeline-as-code---usage-guide>Pipeline as Code - Usage Guide</a><ul><li><a href=#repository-crd>Repository CRD</a></li><li><a href=#authoring-pipelinerun-in-tekton-directory>Authoring PipelineRun in <code>.tekton/</code> directory</a><ul><li><a href=#matching-an-event-to-a-pipelinerun>Matching an event to a PipelineRun</a></li><li><a href=#advanced-event-matching>Advanced event matching</a></li><li><a href=#example>Example</a></li></ul></li><li><a href=#pipelineruns-cleanups>PipelineRuns Cleanups</a></li><li><a href=#private-repositories>Private repositories</a></li><li><a href=#running-the-pipeline>Running the Pipeline</a></li><li><a href=#status>Status</a><ul><li><a href=#github>GitHub</a></li><li><a href=#notifications>Notifications</a></li></ul></li><li><a href=#cli>CLI</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=pipeline-as-code---usage-guide>Pipeline as Code - Usage Guide
<a class=anchor href=#pipeline-as-code---usage-guide>#</a></h1><h2 id=repository-crd>Repository CRD
<a class=anchor href=#repository-crd>#</a></h2><p>The purposes of the Repository CRD is :</p><ul><li>To let <em>Pipelines as Code</em> know that this event from this URL needs to be handled.</li><li>To let <em>Pipelines as Code</em> know on which namespace the PipelineRuns are going to be executed.</li><li>To reference a api secret, username or api URL if needed for the git provider
platforms that requires it (ie: when you are using webhooks method and not
the github application).</li><li>To give the last Pipelinerun status for that Repository (5 by default).</li></ul><p>The flow looks like this :</p><p>Via the tkn pac CLI or other method the user creates a <code>Repository</code> CR
inside the target namespace <code>my-pipeline-ci</code> :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>cat &lt;&lt;EOF|kubectl create -n my-pipeline-ci -f-</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;pipelinesascode.tekton.dev/v1alpha1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span><span style=color:#111>:</span> <span style=color:#ae81ff>Repository</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>scratch-my-back</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;https://github.com/linda/project&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div><p>Whenever there is a event coming from <code>github.com/linda/project</code> Pipelines as
Code will match it and starts checking out the content of the <code>linda/project</code>
for pipelinerun to match in the <code>.tekton/</code> directory.</p><p>The Repository CRD needs to be created in the namespace where Tekton Pipelines
associated with the source code repository would be executed, it cannot target
another namespace.</p><p>If there is multiples CRD matching the same event, only the oldest one will
match. If you need to match a specific namespace you would need to use the
target-namespace feature in the pipeline annotation (see below).</p><p>There is another optional layer of security where PipelineRun can have an
annotation to explicitly target a specific
namespace. It would still need to have a Repository CRD created in that
namespace to be able to be matched.</p><p>With this annotation a bad actor on a cluster cannot hijack the pipelineRun
execution to a namespace they don&rsquo;t have access to. To use that feature you
need to add this annotation to the pipeline annotation :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>pipelinesascode.tekton.dev/target-namespace</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;mynamespace&#34;</span>
</span></span></code></pre></div><p>and Pipelines as Code will only match the repository in the mynamespace
Namespace instead of trying to match it from all available repository on cluster.</p><h2 id=authoring-pipelinerun-in-tekton-directory>Authoring PipelineRun in <code>.tekton/</code> directory
<a class=anchor href=#authoring-pipelinerun-in-tekton-directory>#</a></h2><ul><li><p>Pipelines as Code will always try to be as close to the tekton template as
possible. Usually you will write your template and save them with a &ldquo;.yaml&rdquo;
extension and Pipelines as Code will run them.</p></li><li><p>Using its <a href=./resolver>resolver</a> Pipelines as Code will try to bundle the
PipelineRun with all its Task as a single PipelineRun with no external
dependences.</p></li><li><p>Inside your pipeline you need to be able to check out the commit as
received from the webhook by checking it out the repository from that ref. You
would usually use the
<a href=https://github.com/tektoncd/catalog/blob/main/task/git-clone/>git-clone</a>
task from catalog.</p><p>To be able to specify the parameters of your commit and url, Pipelines as Code
allows you to have those &ldquo;dynamic&rdquo; variables expanded. Those variables look
like this <code>{{ var }}</code>and those are the one you can use:</p><ul><li><code>{{repo_owner}}</code>: The repository owner.</li><li><code>{{repo_name}}</code>: The repository name.</li><li><code>{{repo_url}}</code>: The repository full URL.</li><li><code>{{revision}}</code>: The commit full sha revision.</li><li><code>{{sender}}</code>: The sender username (or account id on some providers) of the commit.</li><li><code>{{source_branch}}</code>: The branch name where the event come from.</li><li><code>{{target_branch}}</code>: The branch name on which the event targets (same as <code>source_branch</code> for push events).</li></ul></li><li><p>You need at least one <code>PipelineRun</code> with a <code>PipelineSpec</code> or a separated
<code>Pipeline</code> object. You can have embedded <code>TaskSpec</code> inside
<code>Pipeline</code> or you can have them defined separately as <code>Task</code>.</p></li></ul><h3 id=matching-an-event-to-a-pipelinerun>Matching an event to a PipelineRun
<a class=anchor href=#matching-an-event-to-a-pipelinerun>#</a></h3><p>Each <code>PipelineRun</code> can match different git provider events via some special
annotations on the <code>PipelineRun</code>. For example when you have these metadatas in
your <code>PipelineRun</code>:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span> <span style=color:#f92672>metadata</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>pipeline-pr-main</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pipelinesascode.tekton.dev/on-target-branch</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;[main]&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pipelinesascode.tekton.dev/on-event</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;[pull_request]&#34;</span>
</span></span></code></pre></div><p><code>Pipelines as Code</code> will match the pipelinerun <code>pipeline-pr-main</code> if the git
provider events target the branch <code>main</code> and it&rsquo;s coming from a <code>[pull_request]</code></p><p>Multiple target branch can be specified separated by comma, i.e:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#111>[</span><span style=color:#ae81ff>main, release-nightly]</span>
</span></span></code></pre></div><p>You can match on <code>pull_request</code> events as above and you can as well match
pipelineRuns on <code>push</code> events to a repository</p><p>For example this will match the pipeline when there is a push to a commit in the
<code>main</code> branch :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span> <span style=color:#f92672>metadata</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>pipeline-push-on-main</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pipelinesascode.tekton.dev/on-target-branch</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;[refs/heads/main]&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pipelinesascode.tekton.dev/on-event</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;[push]&#34;</span>
</span></span></code></pre></div><p>You can specify the full refs like <code>refs/heads/main</code> or the shortref like
<code>main</code>. You can as well specify globs, for example <code>refs/heads/*</code> will match any
target branch or <code>refs/tags/1.*</code> will match all the tags starting from <code>1.</code>.</p><p>A full example for a push of a tag :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span> <span style=color:#f92672>metadata</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>pipeline-push-on-1.0-tags</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pipelinesascode.tekton.dev/on-target-branch</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;[refs/tags/1.0]&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pipelinesascode.tekton.dev/on-event</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;[push]&#34;</span>
</span></span></code></pre></div><p>This will match the pipeline <code>pipeline-push-on-1.0-tags</code> when you push the 1.0
tags into your repository.</p><p>Matching annotations are currently mandated or <code>Pipelines as Code</code> will not
match your <code>PipelineRun</code>.</p><p>If there is multiple pipeline matching an event, it will match the first one. We
are currently not supporting multiple PipelineRuns on a single event but this
may be something we can consider to implement in the future.</p><h3 id=advanced-event-matching>Advanced event matching
<a class=anchor href=#advanced-event-matching>#</a></h3><p>If you need to do some advanced matching, <code>Pipelines as Code</code> supports CEL
filtering.</p><p>If you have the <code>pipelinesascode.tekton.dev/on-cel-expression</code> annotation in
your PipelineRun, the CEL expression will be used and the <code>on-target-branch</code> or
<code>on-target-branch</code> annotations will then be skipped.</p><p>For example :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>pipelinesascode.tekton.dev/on-cel-expression</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>      </span>      <span style=color:#ae81ff>event == &#34;pull_request&#34; &amp;&amp; target_branch == &#34;main&#34; &amp;&amp; source_branch == &#34;wip&#34;</span>
</span></span></code></pre></div><p>will match a <code>pull_request</code> event targetting the branch <code>main</code> coming from a branch called <code>wip</code>.</p><p>The fields available are :</p><ul><li><code>event</code>: <code>push</code> or <code>pull_request</code></li><li><code>target_branch</code>: The branch we are targetting.</li><li><code>source_branch</code>: The branch where this pull_request come from. (on <code>push</code> this is the same as <code>target_branch</code>).</li></ul><p>Compared to the simple &ldquo;on-target&rdquo; annotation matching, the CEL expression
allows you to complex filtering and most importantly express negation.</p><p>For example if I want to have a <code>PipelineRun</code> targeting a <code>pull_request</code> but
not the <code>experimental</code> branch I would have :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>pipelinesascode.tekton.dev/on-cel-expression</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>      </span>      <span style=color:#ae81ff>event == &#34;pull_request&#34; &amp;&amp; target_branch != experimental&#34;</span>
</span></span></code></pre></div><p>You can find more information about the CEL language spec here :</p><p><a href=https://github.com/google/cel-spec/blob/master/doc/langdef.md>https://github.com/google/cel-spec/blob/master/doc/langdef.md</a></p><h3 id=example>Example
<a class=anchor href=#example>#</a></h3><p><code>Pipelines as code</code> test itself, you can see the examples in its
<a href=./../.tekton>.tekton</a> repository.</p><h2 id=pipelineruns-cleanups>PipelineRuns Cleanups
<a class=anchor href=#pipelineruns-cleanups>#</a></h2><p>There can be a lot of PipelineRuns into an user namespace and Pipelines as Code
has the ability to only keep a number of PipelineRuns that matches an event.</p><p>For example if the PipelineRun has this annotation :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>pipelinesascode.tekton.dev/max-keep-runs</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;maxNumber&#34;</span>
</span></span></code></pre></div><p>Pipelines as Code sees this and will start cleaning up right after it finishes a
successful execution keeping only the maxNumber of PipelineRuns.</p><p>It will skip the <code>Running</code> PipelineRuns but will not skip the PipelineRuns with
<code>Unknown</code> status.</p><h2 id=private-repositories>Private repositories
<a class=anchor href=#private-repositories>#</a></h2><p>Pipelines as Code support private repositories by creating or updating a secret
in the target namespace with the user token for the
<a href=https://github.com/tektoncd/catalog/blob/main/task/git-clone>git-clone</a> task
to use and be able to clone private repositories.</p><p>Whenever Pipelines as Code create a new PipelineRun in the target namespace it
will create or update a secret called :</p><p><code>pac-git-basic-auth-REPOSITORY_OWNER-REPOSITORY_NAME</code></p><p>The secret contains a <code>.gitconfig</code> and a git credentials <code>.git-credentials</code> with
the https url using the token it discovered from the Github application or
attached to the secret.</p><p>As documented :</p><p><a href=https://github.com/tektoncd/catalog/blob/main/task/git-clone/0.4/README.md>https://github.com/tektoncd/catalog/blob/main/task/git-clone/0.4/README.md</a></p><p>the secret needs to be referenced inside your PipelineRun and Pipeline as a
workspace called basic-auth to be passed to the <code>git-clone</code> task.</p><p>For example in your PipelineRun you will add the workspace referencing the
Secret :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>workspace</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>basic-auth</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>secret</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>secretName</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;pac-git-basic-auth-{{repo_owner}}-{{repo_name}}&#34;</span>
</span></span></code></pre></div><p>And inside your pipeline, you are referencing them for the git-clone to reuse :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#111>[</span><span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>workspaces</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>name basic-auth</span>
</span></span><span style=display:flex><span><span style=color:#f92672>params</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>repo_url</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>revision</span>
</span></span><span style=display:flex><span><span style=color:#111>[</span><span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>tasks</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>workspaces</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>basic-auth</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>workspace</span><span style=color:#111>:</span> <span style=color:#ae81ff>basic-auth</span>
</span></span><span style=display:flex><span>  <span style=color:#111>[</span><span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tasks</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>git-clone-from-catalog</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>taskRef</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>git-clone</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>params</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>url</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span><span style=color:#111>:</span> <span style=color:#ae81ff>$(params.repo_url)</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>revision</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span><span style=color:#111>:</span> <span style=color:#ae81ff>$(params.revision)</span>
</span></span></code></pre></div><p>The git-clone task will pick up the basic-auth (optional) workspace and
automatically use it to be able to clone the private repository.</p><p>You can see as well a full example <a href=./../test/testdata/pipelinerun_git_clone_private.yaml>here</a></p><p>This behavior can be disabled by configuration the <code>secret-auto-create</code> key
inside the <a href=/docs/install#configuration>Pipelines-as-Code Configmap</a>.</p><h2 id=running-the-pipeline>Running the Pipeline
<a class=anchor href=#running-the-pipeline>#</a></h2><ul><li><p>A user create a Pull Request.</p></li><li><p>Pipelines as Code picks the event and matches to a Repo CRD installed on the
cluster.</p></li><li><p>The user would only be allowed to run the CI if :</p><ul><li>The user is the owner of the repository.</li><li>The user is a collaborator on the repository.</li><li>The user is a public member on the organization of the repository.</li></ul></li><li><p>If the user is sending the Pull Request is inside an OWNER file located in the
repository root on the main branch (the main branch as defined in the Github
configuration for the repo) and added to either <code>approvers</code> or <code>reviewers</code>
sections like this :</p></li></ul><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>approvers</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>approved</span>
</span></span></code></pre></div><p>then the user <code>approved</code> will be allowed.</p><ul><li><p>If the sender of a PR is not allowed to run CI but one of allowed user issue a
<code>/ok-to-test</code> in any line of a comment the PR will be allowed to run CI.</p></li><li><p>If the user is allowed, <code>Pipelines as Code</code> will start creating the
<code>PipelineRun</code> in the target user namespace.</p></li><li><p>The user can follow the execution of your pipeline with the
<a href=https://github.com/tektoncd/cli>tkn</a> cli :</p></li></ul><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>tkn pr logs -n my-pipeline-ci -Lf
</span></span></code></pre></div><p>Or with the OpenShift console inside your namespace to follow the pipelinerun
execution via the URL provided on the &ldquo;Checks&rdquo; tab if you run with Github App.</p><h2 id=status>Status
<a class=anchor href=#status>#</a></h2><h3 id=github>GitHub
<a class=anchor href=#github>#</a></h3><p>When the pipeline finishes the status will be added in the Github Check tabs
with a short recap of how long each task of your pipeline took and the output of
<code>tkn pr describe</code>.</p><p>If there was a failure you can click on the &ldquo;Re-Run&rdquo; button on the left to rerun
the Pipeline or you can issue a issue comment with a line starting and finishing
with the string <code>/retest</code> to ask Pipelines as Code to retest the current PR.</p><p>Example :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-text data-lang=text><span style=display:flex><span>Thanks for contributing! This is a much needed bugfix! ❤️
</span></span><span style=display:flex><span>The failure is not with your PR but seems to be an infra issue.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/retest
</span></span></code></pre></div><h4 id=crd>CRD
<a class=anchor href=#crd>#</a></h4><p>Status of your pipeline execution is stored inside the Repo CustomResource :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>% kubectl get repo -n pipelines-as-code-ci
</span></span><span style=display:flex><span>NAME                  URL                                                        NAMESPACE             SUCCEEDED   REASON      STARTTIME   COMPLETIONTIME
</span></span><span style=display:flex><span>pipelines-as-code-ci   https://github.com/openshift-pipelines/pipelines-as-code   pipelines-as-code-ci   True        Succeeded   59m         56m
</span></span></code></pre></div><p>The last 5 status are stored inside the CustomResource and can be accessed
directly like this :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>% kubectl get repo -n pipelines-as-code-ci -o json<span style=color:#111>|</span>jq .items<span style=color:#f92672>[]</span>.pipelinerun_status
</span></span><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    &#34;completionTime&#34;: &#34;2021-05-05T11:00:05Z&#34;,
</span></span><span style=display:flex><span>    &#34;conditions&#34;: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        &#34;lastTransitionTime&#34;: &#34;2021-05-05T11:00:05Z&#34;,
</span></span><span style=display:flex><span>        &#34;message&#34;: &#34;Tasks Completed: 3 (Failed: 0, Cancelled 0), Skipped: 0&#34;,
</span></span><span style=display:flex><span>        &#34;reason&#34;: &#34;Succeeded&#34;,
</span></span><span style=display:flex><span>        &#34;status&#34;: &#34;True&#34;,
</span></span><span style=display:flex><span>        &#34;type&#34;: &#34;Succeeded&#34;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    &#34;pipelineRunName&#34;: &#34;pipelines-as-code-test-run-7tr84&#34;,
</span></span><span style=display:flex><span>    &#34;startTime&#34;: &#34;2021-05-05T10:53:43Z&#34;
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    &#34;completionTime&#34;: &#34;2021-05-05T11:20:18Z&#34;,
</span></span><span style=display:flex><span>    &#34;conditions&#34;: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        &#34;lastTransitionTime&#34;: &#34;2021-05-05T11:20:18Z&#34;,
</span></span><span style=display:flex><span>        &#34;message&#34;: &#34;Tasks Completed: 3 (Failed: 0, Cancelled 0), Skipped: 0&#34;,
</span></span><span style=display:flex><span>        &#34;reason&#34;: &#34;Succeeded&#34;,
</span></span><span style=display:flex><span>        &#34;status&#34;: &#34;True&#34;,
</span></span><span style=display:flex><span>        &#34;type&#34;: &#34;Succeeded&#34;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    &#34;pipelineRunName&#34;: &#34;pipelines-as-code-test-run-2fhhg&#34;,
</span></span><span style=display:flex><span>    &#34;startTime&#34;: &#34;2021-05-05T11:11:20Z&#34;
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  [...]
</span></span></code></pre></div><h3 id=notifications>Notifications
<a class=anchor href=#notifications>#</a></h3><p>Notifications is not handled by Pipelines as Code, the only place where we
notify a status in a interface is when we do a Pull Request on for example the
Github checks interface to show the results of the pull request.</p><p>If you need some other type of notification you can use
the <a href=https://github.com/tektoncd/pipeline/blob/main/docs/pipelines.md#adding-finally-to-the-pipeline>finally feature of tekton pipeline</a>
.</p><p>Here is an example task to send a slack message on failures (or success if you
like) :</p><p><a href=https://github.com/chmouel/tekton-slack-task-status>https://github.com/chmouel/tekton-slack-task-status</a></p><p>The push pipeline of Pipelines as Code use this task, you can see the example
here :</p><p><a href=https://github.com/openshift-pipelines/pipelines-as-code/blob/7b41cc3f769af40a84b7ead41c6f037637e95070/.tekton/push.yaml#L116>.tekton/push.yaml</a></p><h2 id=cli>CLI
<a class=anchor href=#cli>#</a></h2><p><code>Pipelines as Code</code> provide a CLI which is design to work as tkn plugin. See the
installation instruction on how to install and use it <a href=./guide/cli>here</a>.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/openshift-pipelines/pipelines-as-code/commit/e2ef12415f0e5a78011b4244dd2701627dcf40e2 title="Last modified by Chmouel Boudjnah | March 28, 2022" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 28, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/openshift-pipelines/pipelines-as-code/edit/main/docs/content/docs/guide/_index.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#pipeline-as-code---usage-guide>Pipeline as Code - Usage Guide</a><ul><li><a href=#repository-crd>Repository CRD</a></li><li><a href=#authoring-pipelinerun-in-tekton-directory>Authoring PipelineRun in <code>.tekton/</code> directory</a><ul><li><a href=#matching-an-event-to-a-pipelinerun>Matching an event to a PipelineRun</a></li><li><a href=#advanced-event-matching>Advanced event matching</a></li><li><a href=#example>Example</a></li></ul></li><li><a href=#pipelineruns-cleanups>PipelineRuns Cleanups</a></li><li><a href=#private-repositories>Private repositories</a></li><li><a href=#running-the-pipeline>Running the Pipeline</a></li><li><a href=#status>Status</a><ul><li><a href=#github>GitHub</a></li><li><a href=#notifications>Notifications</a></li></ul></li><li><a href=#cli>CLI</a></li></ul></li></ul></nav></div></aside></main></body></html>