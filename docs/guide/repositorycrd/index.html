<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Repository CRD #  The purposes of the Repository CRD is:
 To let Pipelines as Code know that this event from this URL needs to be handled. To let Pipelines as Code know on which namespace the PipelineRuns are going to be executed. To reference a api secret, username or api URL if needed for the git provider platforms that requires it (ie: when you are using webhooks method and not the github application)."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Repository CRD"><meta property="og:description" content="Repository CRD #  The purposes of the Repository CRD is:
 To let Pipelines as Code know that this event from this URL needs to be handled. To let Pipelines as Code know on which namespace the PipelineRuns are going to be executed. To reference a api secret, username or api URL if needed for the git provider platforms that requires it (ie: when you are using webhooks method and not the github application)."><meta property="og:type" content="article"><meta property="og:url" content="/docs/guide/repositorycrd/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-03-29T16:15:17+02:00"><title>Repository CRD | Pipelines as Code</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.1c2b8db87162daaca064b7f5567326f809e7e21f4aa70a932a7dfdb65da9ed62.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/pipelines-logo.svg alt=Logo><span>Pipelines as Code</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/install/>Installation</a><ul><li><a href=/docs/install/overview/>Overview</a></li><li><a href=/docs/install/installation/>Infrastructure install</a></li><li><a href=/docs/install/settings/>Settings</a></li><li><a href=/docs/install/github_apps/>Github Apps</a></li><li><a href=/docs/install/github_webhook/>Github Webhook</a></li><li><a href=/docs/install/gitlab/>Gitlab</a></li><li><a href=/docs/install/bitbucket_cloud/>Bitbucket Cloud</a></li><li><a href=/docs/install/bitbucket_server/>Bitbucket Server</a></li><li><a href=/docs/install/kubernetes/>Kubernetes</a></li></ul></li><li><a href=/docs/guide/>Usage Guide</a><ul><li><a href=/docs/guide/repositorycrd/ class=active>Repository CRD</a></li><li><a href=/docs/guide/resolver/>Resolver</a></li><li><a href=/docs/guide/autoringprs/>Authoring PipelineRun</a></li><li><a href=/docs/guide/running/>Running the PipelineRun</a></li><li><a href=/docs/guide/statuses/>PipelineRun status</a></li><li><a href=/docs/guide/privaterepo/>Private Repositories</a></li><li><a href=/docs/guide/cleanups/>PipelineRuns Cleanup</a></li><li><a href=/docs/guide/cli/>CLI tkn-pac</a></li></ul></li></ul><ul><li><a href=https://github.com/openshift-pipelines/pipelines-as-code target=_blank rel=noopener>Github Pipelines as Code</a></li><li><a href=https://tekton.dev/docs/ target=_blank rel=noopener>TektonCD Documentation</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Repository CRD</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#repository-crd>Repository CRD</a></li></ul></nav></aside></header><article class=markdown><h2 id=repository-crd>Repository CRD
<a class=anchor href=#repository-crd>#</a></h2><p>The purposes of the Repository CRD is:</p><ul><li>To let <em>Pipelines as Code</em> know that this event from this URL needs to be handled.</li><li>To let <em>Pipelines as Code</em> know on which namespace the PipelineRuns are going to be executed.</li><li>To reference a api secret, username or api URL if needed for the git provider
platforms that requires it (ie: when you are using webhooks method and not
the github application).</li><li>To give the last Pipelinerun status for that Repository (5 by default).</li></ul><p>The flow looks like this :</p><p>Via the tkn pac CLI or other method the user creates a <code>Repository</code> CR
inside the target namespace <code>my-pipeline-ci</code> :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>cat &lt;&lt;EOF|kubectl create -n my-pipeline-ci -f-</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;pipelinesascode.tekton.dev/v1alpha1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span><span style=color:#111>:</span> <span style=color:#ae81ff>Repository</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>project-repository</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;https://github.com/linda/project&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div><p>Whenever there is a event coming from <code>github.com/linda/project</code> Pipelines as
Code will match it and starts checking out the content of the <code>linda/project</code>
for pipelinerun to match in the <code>.tekton/</code> directory.</p><p>The Repository CRD needs to be created in the namespace where Tekton Pipelines
associated with the source code repository would be executed, it cannot target
another namespace.</p><p>If there is multiples CRD matching the same event, only the oldest one will
match. If you need to match a specific namespace you would need to use the
target-namespace feature in the pipeline annotation (see below).</p><p>There is another optional layer of security where PipelineRun can have an
annotation to explicitly target a specific
namespace. It would still need to have a Repository CRD created in that
namespace to be able to be matched.</p><p>With this annotation a bad actor on a cluster cannot hijack the pipelineRun
execution to a namespace they don&rsquo;t have access to. To use that feature you
need to add this annotation to the pipeline annotation :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>pipelinesascode.tekton.dev/target-namespace</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;mynamespace&#34;</span>
</span></span></code></pre></div><p>and Pipelines as Code will only match the repository in the mynamespace
Namespace instead of trying to match it from all available repository on cluster.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/openshift-pipelines/pipelines-as-code/commit/7a3b4a01230638b8d7f76dda41b94a5f8f622bcf title="Last modified by Chmouel Boudjnah | March 29, 2022" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 29, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/openshift-pipelines/pipelines-as-code/edit/main/docs/content/docs/guide/repositorycrd.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#repository-crd>Repository CRD</a></li></ul></nav></div></aside></main></body></html>