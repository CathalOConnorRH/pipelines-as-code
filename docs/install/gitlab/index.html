<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Install Pipelines-as-Code for Gitlab #  Pipelines-As-Code supports Gitlab via a webhook.
Following the infrastructure installation:
  You will have to generate a personal token as the manager of the Org or the Project, follow the steps here :
https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html
Note: You can create a token scoped only to the project. Since the token needs to be able to have api access to the forked repository from where the MR come from, it will fail to do it with a project scoped token."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Gitlab"><meta property="og:description" content="Install Pipelines-as-Code for Gitlab #  Pipelines-As-Code supports Gitlab via a webhook.
Following the infrastructure installation:
  You will have to generate a personal token as the manager of the Org or the Project, follow the steps here :
https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html
Note: You can create a token scoped only to the project. Since the token needs to be able to have api access to the forked repository from where the MR come from, it will fail to do it with a project scoped token."><meta property="og:type" content="article"><meta property="og:url" content="/docs/install/gitlab/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-03-30T13:50:06+05:30"><title>Gitlab | Pipelines as Code</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.10540941842b4e5e940226bfba9ecf90e4aacde5b742c91761bc696f0eed31a7.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/pipelines-logo.svg alt=Logo><span>Pipelines as Code</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/install/>Installation</a><ul><li><a href=/docs/install/overview/>Overview</a></li><li><a href=/docs/install/installation/>Infrastructure install</a></li><li><a href=/docs/install/settings/>Settings</a></li><li><a href=/docs/install/github_apps/>Github Apps</a></li><li><a href=/docs/install/github_webhook/>Github Webhook</a></li><li><a href=/docs/install/gitlab/ class=active>Gitlab</a></li><li><a href=/docs/install/bitbucket_cloud/>Bitbucket Cloud</a></li><li><a href=/docs/install/bitbucket_server/>Bitbucket Server</a></li><li><a href=/docs/install/kubernetes/>Kubernetes</a></li></ul></li><li><a href=/docs/guide/>Usage Guide</a><ul><li><a href=/docs/guide/repositorycrd/>Repository CRD</a></li><li><a href=/docs/guide/resolver/>Resolver</a></li><li><a href=/docs/guide/autoringprs/>Authoring PipelineRun</a></li><li><a href=/docs/guide/running/>Running the PipelineRun</a></li><li><a href=/docs/guide/statuses/>PipelineRun status</a></li><li><a href=/docs/guide/privaterepo/>Private Repositories</a></li><li><a href=/docs/guide/cleanups/>PipelineRuns Cleanup</a></li><li><a href=/docs/guide/cli/>CLI tkn-pac</a></li></ul></li></ul><ul><li><a href=https://github.com/openshift-pipelines/pipelines-as-code target=_blank rel=noopener>Github Pipelines as Code</a></li><li><a href=https://tekton.dev/docs/ target=_blank rel=noopener>TektonCD Documentation</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Gitlab</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#notes>Notes</a></li></ul></nav></aside></header><article class=markdown><h1 id=install-pipelines-as-code-for-gitlab>Install Pipelines-as-Code for Gitlab
<a class=anchor href=#install-pipelines-as-code-for-gitlab>#</a></h1><p>Pipelines-As-Code supports <a href=https://www.gitlab.com>Gitlab</a> via a webhook.</p><p>Following the <a href=install.md#install-pipelines-as-code-infrastructure>infrastructure installation</a>:</p><ul><li><p>You will have to generate a personal token as the manager of the Org or the Project,
follow the steps here :</p><p><a href=https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html>https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html</a></p><p><strong>Note</strong>: You can create a token scoped only to the project. Since the
token needs to be able to have <code>api</code> access to the forked repository from where
the MR come from, it will fail to do it with a project scoped token. We try
to fallback nicely by showing the status of the pipeline directly as comment
of the the Merge Request.</p></li><li><p>Go to your project and click on <em>Settings</em> and <em>&ldquo;Webhooks&rdquo;</em> from the sidebar on the left.</p></li><li><p>Set the payload URL to the event listener public URL. On OpenShift you can get the public URL of the
Pipelines-as-Code controller like this :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#111>echo</span> https://<span style=color:#00a8c8>$(</span>oc get route -n pipelines-as-code pipelines-as-code-controller -o <span style=color:#111>jsonpath</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;{.spec.host}&#39;</span><span style=color:#00a8c8>)</span>
</span></span></code></pre></div></li><li><p>Add a secret or generate a random one with this command :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>openssl rand -hex <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span><span style=color:#d88200>``</span>
</span></span></code></pre></div></li><li><p><a href=/images/gitlab-add-webhook.png>Refer to this screenshot</a> on how to configure the Webhook.</p><p>The individual events to select are :</p><ul><li>Merge request Events</li><li>Push Events</li><li>Note Events</li></ul></li><li><p>On your cluster you need create the webhook secret as generated previously in the <em>pipelines-as-code</em> namespace.</p></li></ul><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n pipelines-as-code create secret generic pipelines-as-code-secret <span style=color:#8045ff>\
</span></span></span><span style=display:flex><span><span style=color:#8045ff></span>        --from-literal webhook.secret<span style=color:#f92672>=</span><span style=color:#d88200>&#34;</span><span style=color:#111>$WEBHOOK_SECRET_AS_GENERATED</span><span style=color:#d88200>&#34;</span>
</span></span></code></pre></div><ul><li><p>You are now able to create a Repository CRD. The repository CRD will have a
Secret that contains the Personal token as generated and Pipelines as Code
will know how to use it for Gitlab API operations.</p></li><li><p>First create the secret with the personal token in the <code>target-namespace</code> (where you are planning to run your pipeline CI) :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n target-namespace create secret generic gitlab-personal-token <span style=color:#8045ff>\
</span></span></span><span style=display:flex><span><span style=color:#8045ff></span>        --from-literal <span style=color:#111>token</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;TOKEN_AS_GENERATED_PREVIOUSLY&#34;</span>
</span></span></code></pre></div></li><li><p>And now create Repository CRD with the secret field referencing it.</p></li></ul><p>Here is an example of a Repository CRD :</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#111>---</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;pipelinesascode.tekton.dev/v1alpha1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span><span style=color:#111>:</span> <span style=color:#ae81ff>Repository</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>my-repo</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span><span style=color:#111>:</span> <span style=color:#ae81ff>target-namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;https://gitlab.com/group/project&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>git_provider</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>secret</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;gitlab-personal-token&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Set this if you have a different key in your secret</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># key: &#34;token&#34;</span>
</span></span></code></pre></div><h2 id=notes>Notes
<a class=anchor href=#notes>#</a></h2><ul><li><p>Private instance are automatically detected, no need to specify the api url. Unless you want to override it then you can simply add it to the spec<code>.git_provider.url</code> field.</p></li><li><p><code>git_provider.secret</code> cannot reference a secret in another namespace,
Pipelines as code assumes always it will be the same namespace as where the
repository has been created.</p></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/openshift-pipelines/pipelines-as-code/commit/159e00d531c22bad9d2500888a4c584597b4661a title="Last modified by Shivam Mukhade | March 30, 2022" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 30, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/openshift-pipelines/pipelines-as-code/edit/main/docs/content/docs/install/gitlab.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#notes>Notes</a></li></ul></nav></div></aside></main></body></html>